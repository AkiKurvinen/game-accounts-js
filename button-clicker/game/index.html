<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <link rel="shortcut icon" href="../img/button_logo.png" type="image/x-icon">
    <link rel="stylesheet" href="assets/loginform.css">
</head>

<body>
    <script>
        let click_count = 0;
        let counter_txt;
        let user_id = 123;


        class Example extends Phaser.Scene {
            constructor() {
                super();
            }

            preload() {
                this.load.html('loginform', 'assets/loginform.html');
            }
            async getTopScores() {
                click_count++
                counter_txt.setText(`Click count: ${click_count}`)
            }
            async saveHiscore() {
                const json = { "user_id": 123, "hiscore": click_count }
                console.log("Call API", json)
            }

            create() {
                this.add.text(16, 16, 'Click the Button').setFontSize(24).setShadow(1, 1);
                counter_txt = this.add.text(16, 64, `0`).setFontSize(24).setShadow(1, 1);


                counter_txt.setText(`Click count: ${click_count}`)

                // button call API
                const button_score = this.add.text(700, 550, 'Save position', {
                    fontFamily: 'Arial',
                    fontSize: '16px',
                    color: '#ffffff',
                    align: 'center',
                    fixedWidth: 120,
                    backgroundColor: '#2d2d2d'
                }).setPadding(8).setOrigin(0.5);

                button_score.setInteractive({ useHandCursor: true });

                button_score.on('pointerover', () => {
                    button_score.setBackgroundColor('#8d8d8d');
                });

                button_score.on('pointerout', () => {
                    button_score.setBackgroundColor('#2d2d2d');
                });

                button_score.on('pointerdown', () => {
                    button_score.setBackgroundColor('#000');
                    this.saveHiscore()
                });


                // button add counter
                const button = this.add.text(400, 300, 'Button', {
                    fontFamily: 'Arial',
                    fontSize: '16px',
                    color: '#ffffff',
                    align: 'center',
                    fixedWidth: 120,
                    backgroundColor: '#2d2d2d'
                }).setPadding(8).setOrigin(0.5);

                button.setInteractive({ useHandCursor: true });

                button.on('pointerover', () => {
                    button.setBackgroundColor('#8d8d8d');
                });

                button.on('pointerout', () => {
                    button.setBackgroundColor('#2d2d2d');
                });

                button.on('pointerdown', () => {
                    this.getTopScores()
                });

                // login form
                const text = this.add.text(300, 10, 'Please enter your name', { color: 'white', fontSize: '16px ' });
                const element = this.add.dom(350, 300).createFromCache('loginform');

                element.addListener('click');

                element.on('click', function (event) {

                    if (event.target.name === 'playButton') {
                        const inputText = this.getChildByName('nameField');

                        //  Have they entered anything?
                        if (inputText.value !== '') {
                            //  Turn off the click events
                            this.removeListener('click');

                            //  Hide the login element
                            this.setVisible(false);

                            //  Populate the text with whatever they typed in
                            text.setText(`Welcome ${inputText.value}`);
                        }
                        else {
                            //  Flash the prompt
                            this.scene.tweens.add({
                                targets: text,
                                alpha: 0.2,
                                duration: 250,
                                ease: 'Power3',
                                yoyo: true
                            });
                        }
                    }

                });
            }

        }

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'phaser-example',
            scene: Example,
            dom: {
                createContainer: true
            },
        };

        const game = new Phaser.Game(config);
    </script>

</body>

</html>